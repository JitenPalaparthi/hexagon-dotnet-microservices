# TLS Certificate Lifecycle ‚Äî Development vs Production

| File | Belongs to | Contains / Format | Used for | Who creates it | Where it lives (Prod) | Key notes & details |
|------|-------------|------------------|-----------|----------------|-----------------------|---------------------|
| **ca.key** | üîê Root Certificate Authority (CA) | Private RSA / ECC key (PEM) | Used to **sign CSRs** (certificate signing requests) and issue subordinate or server certificates. | **Security / PKI team** (once in the org‚Äôs CA system). Never generated on app servers. | Stored securely in an **HSM** (Hardware Security Module) or CA host; never leaves it. | The ‚Äúmaster key‚Äù of trust. If compromised, all certificates signed by this CA become invalid. In production, it is *offline* and guarded. |
| **ca.crt** | ü™™ Root Certificate Authority | Public certificate of the CA | Distributed to **servers and clients** that need to trust this CA. | Generated automatically from `ca.key` during CA setup. | Trusted root store (Linux: `/etc/ssl/certs/`, Windows: ‚ÄúTrusted Root CAs‚Äù, Cloud: Key Vault / ACM). | Serves as the ‚Äúroot of trust.‚Äù Every client must have this certificate (or its public fingerprint) to verify server certificates signed by this CA. |
| **ca.srl** | üßæ Root CA | Serial number ledger | Tracks the **last serial number** issued by this CA to ensure uniqueness. | Generated automatically by OpenSSL when issuing the first certificate with `-CAcreateserial`. | Inside the CA host‚Äôs private directory. | Not needed by application servers. Keeps CA‚Äôs internal record consistency. |
| **san.cnf** | ‚öôÔ∏è Config | Text configuration with Subject Alternative Names (SANs) | Used to specify which hostnames / IPs are valid for a given certificate. | Created by **DevOps** (or automated CSR scripts). | Local temporary file; not deployed. | Required because modern TLS (since Chrome 58+) **ignores the Common Name (CN)** ‚Äî it validates only SANs like `DNS=api.example.com`, `IP=127.0.0.1`. |
| **localhost.key / server.key** | üîê Server | Private key of the server (PEM) | Used to **prove ownership** of the server certificate and to decrypt incoming TLS traffic. | **Generated by DevOps or automation** when creating a CSR. | Production: `/etc/ssl/private/server.key`, `/app/certs/server.key`, or secret store (K8s Secret, Key Vault). | Must be kept secret; never shared. Permissions: 600 (readable only by the service process). If leaked, attackers can impersonate your service. |
| **localhost.csr / server.csr** | üì® Server | Certificate Signing Request (PEM) | Contains the **public key** and identification info (CN, SANs) to be signed by the CA. | **Generated on the same host** as the private key. | Temporary local file; deleted after signing. | Sent to the CA (public or internal) for signing. The CSR is *signed by the private key*, proving key ownership. |
| **localhost.crt / server.crt** | ü™™ Server | Signed certificate (PEM / CRT) | Presented by the server to clients during TLS handshake. | **Issued by the CA** in response to the CSR. | `/etc/ssl/certs/server.crt` (Linux), `/app/certs/server.crt`, or managed cert store (Key Vault, ACM). | Contains: public key, issuer, SANs, validity period, and signature by the CA. When a client connects, it verifies this certificate using `ca.crt`. |
| **localhost.pfx / server.pfx** | üì¶ Server (.NET / Windows) | PKCS#12 bundle (`.pfx` / `.p12`) = cert + private key (+ chain) | Used by **Kestrel**, **IIS**, or **Windows services** to load both key & certificate in one file. | Created by **DevOps** or automation script from `.crt` + `.key` + `ca.crt`. | `/app/certs/server.pfx`, or loaded into Windows Certificate Store (My\Personal). | Requires password protection. Used by .NET apps with: `UseHttps("certs/server.pfx", "password")`. |

---

## üîê How They Work Together

```
[ca.key] ‚Üí [ca.crt] ‚îÄ‚îÄ‚îê
                      ‚îÇ signs
                      ‚ñº
                 [localhost.crt] ‚Üê [localhost.csr] ‚Üê [localhost.key]
                      ‚îÇ
                      ‚îî‚îÄ> bundled into [localhost.pfx]
```

---

## üè≠ Production Roles

| Role | Responsibilities |
|-------|------------------|
| **Security / PKI Team** | Maintains `ca.key`, `ca.crt`, and runs the corporate CA. Controls issuance, rotation, and revocation. |
| **DevOps / Platform Team** | Generates CSRs and private keys for each service, requests signed certs from CA, installs `server.crt` and `server.key` (or `.pfx`) on servers. Manages renewal automation. |
| **Developers** | Use already-issued `.pfx` / `.crt` in app configuration (e.g., `UseHttps(...)`). Do not create or store private keys manually. |
| **Clients / Consumers** | Trust the CA‚Äôs `ca.crt` or rely on OS/browser trusted root store. No manual import for public CAs. |

---

## üß≠ File Locations in Production

| Platform | Certificate Path | Managed By |
|-----------|------------------|------------|
| Linux | `/etc/ssl/certs/server.crt` and `/etc/ssl/private/server.key` | DevOps |
| Windows | Windows Cert Store or `/app/certs/server.pfx` | DevOps |
| Kubernetes | Mounted from Secret ‚Üí `/etc/ssl/tls.crt` and `/etc/ssl/tls.key` | cert-manager / DevOps |
| Azure | Azure Key Vault (linked to App Service) | Azure platform |
| AWS | AWS Certificate Manager (ACM) | AWS platform |
| Let‚Äôs Encrypt | `/etc/letsencrypt/live/<domain>/` | certbot automation |

---

## ‚ö° Example .NET Usage

```csharp
builder.WebHost.ConfigureKestrel(o =>
{
    o.ListenAnyIP(443, lo =>
    {
        lo.Protocols = HttpProtocols.Http2;
        lo.UseHttps("certs/server.pfx", Environment.GetEnvironmentVariable("CERT_PASSWORD"));
    });
});
```

**Server uses:** `server.pfx`  
**Client trusts:** `ca.crt`

---

## üîí Summary

| Purpose | Local / Dev | Production |
|----------|--------------|------------|
| Certificate creation | OpenSSL / mkcert | Public CA / internal PKI |
| Signing authority | Self-signed | Trusted CA |
| Key management | Developer | DevOps / Security |
| Trust mechanism | Manual import of `ca.crt` | Global trust store |
| Storage | `certs/localhost.*` | `/etc/ssl/*` / Key Vault / Secrets |
